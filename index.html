<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>農薬希釈計算ツール</title>
    <link rel="stylesheet" href="style.css">
    <!-- モバイル用のアイコン設定 -->
    <link rel="apple-touch-icon" href="icon.svg">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="theme-color" content="#27ae60">
</head>
<body>
    <div class="container">
        <h1>農薬希釈計算ツール</h1>
        
        <div class="tab-container">
            <div class="tabs">
                <button class="tab-btn active" data-tab="tab1">希釈倍数から薬量を計算</button>
                <button class="tab-btn" data-tab="tab2">薬量から散布水量を計算</button>
                <button class="tab-btn" data-tab="tab3">薬量と水量から倍数を計算</button>
                <button class="tab-btn" data-tab="tab4">くん煙剤計算</button>
                <button class="tab-btn" data-tab="tab5">ppm濃度計算</button>
                <button class="tab-btn" data-tab="tab6">μmol計算</button>
            </div>
            
            <!-- タブ1: 希釈倍数と散布水量から使用薬量を計算 -->
            <div class="tab-content active" id="tab1">
                <div class="calculator">
                    <h2>希釈倍数と散布水量から使用薬量を計算</h2>
                    <p class="calculator-description">散布液量 ÷ 希釈倍数 = 必要な農薬量</p>
                    <div class="input-group">
                        <label for="dilution-ratio1">希釈倍数:</label>
                        <input type="number" inputmode="decimal" id="dilution-ratio1" placeholder="例: 1000">
                        <span>倍</span>
                    </div>
                    <div class="input-group">
                        <label for="water-amount1">散布水量:</label>
                        <input type="number" inputmode="decimal" id="water-amount1" placeholder="例: 10">
                        <select id="water-unit1">
                            <option value="l">L</option>
                            <option value="ml">mL</option>
                        </select>
                    </div>
                    <div class="button-group">
                        <button id="calculate-pesticide-btn" class="primary-btn">計算する</button>
                        <button type="button" class="clear-btn" onclick="clearForm('tab1')">クリア</button>
                    </div>
                    <div class="result">
                        <h3>計算結果 - 必要な農薬量</h3>
                        <div class="result-with-unit-selection">
                            <span id="pesticide-result">-</span>
                            <select id="pesticide-result-unit">
                                <option value="g">g</option>
                                <option value="kg">kg</option>
                                <option value="ml">mL</option>
                                <option value="l">L</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- タブ2: 希釈倍数と使用薬量から散布水量を計算 -->
            <div class="tab-content" id="tab2">
                <div class="calculator">
                    <h2>希釈倍数と使用薬量から散布水量を計算</h2>
                    <p class="calculator-description">農薬量 × 希釈倍数 = 散布液量</p>
                    <div class="input-group">
                        <label for="dilution-ratio2">希釈倍数:</label>
                        <input type="number" inputmode="decimal" id="dilution-ratio2" placeholder="例: 1000">
                        <span>倍</span>
                    </div>
                    <div class="input-group">
                        <label for="pesticide-amount2">使用薬量:</label>
                        <input type="number" inputmode="decimal" id="pesticide-amount2" placeholder="例: 10">
                        <select id="pesticide-unit2">
                            <option value="g">g</option>
                            <option value="kg">kg</option>
                            <option value="ml">mL</option>
                            <option value="l">L</option>
                        </select>
                    </div>
                    <div class="button-group">
                        <button id="calculate-water-btn" class="primary-btn">計算する</button>
                        <button type="button" class="clear-btn" onclick="clearForm('tab2')">クリア</button>
                    </div>
                    <div class="result">
                        <h3>計算結果 - 必要な散布水量</h3>
                        <div class="result-with-unit-selection">
                            <span id="water-result">-</span>
                            <select id="water-result-unit">
                                <option value="l">L</option>
                                <option value="ml">mL</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- タブ3: 使用薬量と散布水量から希釈倍数を計算 -->
            <div class="tab-content" id="tab3">
                <div class="calculator">
                    <h2>使用薬量と散布水量から希釈倍数を計算</h2>
                    <p class="calculator-description">散布液量 ÷ 農薬量 = 希釈倍数</p>
                    <div class="input-group">
                        <label for="pesticide-amount3">使用薬量:</label>
                        <input type="number" inputmode="decimal" id="pesticide-amount3" placeholder="例: 10">
                        <select id="pesticide-unit3">
                            <option value="g">g</option>
                            <option value="kg">kg</option>
                            <option value="ml">mL</option>
                            <option value="l">L</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="water-amount3">散布水量:</label>
                        <input type="number" inputmode="decimal" id="water-amount3" placeholder="例: 10">
                        <select id="water-unit3">
                            <option value="l">L</option>
                            <option value="ml">mL</option>
                        </select>
                    </div>
                    <div class="button-group">
                        <button id="calculate-ratio-btn" class="primary-btn">計算する</button>
                        <button type="button" class="clear-btn" onclick="clearForm('tab3')">クリア</button>
                    </div>
                    <div class="result">
                        <h3>計算結果 - 希釈倍数</h3>
                        <div class="result-with-unit-selection">
                            <span id="ratio-result">-</span>
                            <span>倍</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- タブ4: くん煙剤計算 -->
            <div class="tab-content" id="tab4">
                <div class="calculator">
                    <h2>くん煙剤使用量計算</h2>
                    <p class="calculator-description">（間口 × 長さ × 高さ × 棟数）÷ 登録容積 × 登録薬量 = 必要な薬剤量</p>
                    
                    <h3>ハウスの寸法を入力</h3>
                    <div class="input-group">
                        <label for="fumigant-width">間口（幅）:</label>
                        <input type="number" inputmode="decimal" id="fumigant-width" placeholder="例: 6">
                        <span>m</span>
                    </div>
                    <div class="input-group">
                        <label for="fumigant-length">長さ:</label>
                        <input type="number" inputmode="decimal" id="fumigant-length" placeholder="例: 30">
                        <span>m</span>
                    </div>
                    <div class="input-group">
                        <label for="fumigant-height">高さ:</label>
                        <input type="number" inputmode="decimal" id="fumigant-height" placeholder="例: 3">
                        <span>m</span>
                    </div>
                    <div class="input-group">
                        <label for="fumigant-count">棟数:</label>
                        <input type="number" inputmode="decimal" id="fumigant-count" placeholder="例: 1" value="1">
                        <span>棟</span>
                    </div>
                    
                    <div class="volume-result">
                        <div class="volume-item">
                            <span class="volume-label">単棟容積:</span>
                            <span id="fumigant-single-volume">-</span>
                            <span>m³</span>
                        </div>
                        <div class="volume-item">
                            <span class="volume-label">合計容積:</span>
                            <span id="fumigant-total-volume">-</span>
                            <span>m³</span>
                        </div>
                    </div>
                    
                    <h3>くん煙剤の登録情報を入力</h3>
                    <div class="input-group">
                        <label for="fumigant-reg-volume">登録容積:</label>
                        <input type="number" inputmode="decimal" id="fumigant-reg-volume" placeholder="例: 400">
                        <span>m³</span>
                    </div>
                    <div class="input-group">
                        <label for="fumigant-reg-amount">登録薬量:</label>
                        <input type="number" inputmode="decimal" id="fumigant-reg-amount" placeholder="例: 50">
                        <span>g</span>
                    </div>
                    
                    <div class="button-group">
                        <button onclick="calculateFumigantSimple()" class="primary-btn">計算する</button>
                        <button type="button" class="clear-btn" onclick="clearForm('tab4')">クリア</button>
                    </div>
                    
                    <div class="result">
                        <h3>計算結果 - 必要なくん煙剤量</h3>
                        <div class="result-with-unit-toggle">
                            <span id="fumigant-simple-result">-</span>
                            <div class="unit-toggle">
                                <span class="toggle-label">g</span>
                                <div class="toggle-switch" id="fumigant-simple-toggle" onclick="toggleFumigantSimpleUnit()">
                                    <div class="toggle-slider"></div>
                                </div>
                                <span class="toggle-label">kg</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- タブ5: ppm濃度計算 -->
            <div class="tab-content" id="tab5">
                <div class="calculator">
                    <h2>ppm濃度計算</h2>
                    
                    <!-- サブタブ -->
                    <div class="sub-tabs">
                        <button class="sub-tab-btn active" data-subtab="ppm-forward">濃度→製品重量</button>
                        <button class="sub-tab-btn" data-subtab="ppm-reverse">製品重量→濃度</button>
                    </div>
                    
                    <!-- サブタブ1: 濃度→製品重量計算 -->
                    <div class="sub-tab-content active" id="ppm-forward">
                        <p class="calculator-description">必要な有効成分量(mg) = 濃度(ppm) × 液量(L)</p>
                        <div class="input-group">
                            <label for="target-concentration">目標濃度:</label>
                            <input type="number" inputmode="decimal" id="target-concentration" placeholder="例: 200">
                            <span>ppm</span>
                        </div>
                        <div class="input-group">
                            <label for="spray-volume">散布液量:</label>
                            <input type="number" inputmode="decimal" id="spray-volume" placeholder="例: 10">
                            <div class="unit-toggle">
                                <span class="toggle-label">L</span>
                                <div class="toggle-switch" id="volume-toggle-forward" onclick="toggleVolumeUnit('forward')">
                                    <div class="toggle-slider"></div>
                                </div>
                                <span class="toggle-label">mL</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label for="active-ingredient-forward">有効成分含有率:</label>
                            <input type="number" inputmode="decimal" id="active-ingredient-forward" placeholder="例: 3.1">
                            <span>%</span>
                        </div>
                        <div class="button-group">
                            <button id="calculate-ppm-forward-btn" class="primary-btn">計算する</button>
                            <button type="button" class="clear-btn" onclick="clearForm('ppm-forward')">クリア</button>
                        </div>
                        <div class="result">
                            <h3>計算結果</h3>
                            <div class="result-item">
                                <span class="result-label">必要な製品重量:</span>
                                <div class="result-with-unit-toggle">
                                    <span id="product-weight-result">-</span>
                                    <div class="unit-toggle">
                                        <span class="toggle-label">g</span>
                                        <div class="toggle-switch" id="weight-toggle-forward" onclick="toggleWeightUnit('forward')">
                                            <div class="toggle-slider"></div>
                                        </div>
                                        <span class="toggle-label">kg</span>
                                    </div>
                                </div>
                            </div>
                            <div class="result-item">
                                <span class="result-label">必要な有効成分量:</span>
                                <div class="result-with-unit-toggle">
                                    <span id="active-weight-result">-</span>
                                    <div class="unit-toggle">
                                        <span class="toggle-label">mg</span>
                                        <div class="toggle-switch" id="active-toggle-forward" onclick="toggleActiveUnit('forward')">
                                            <div class="toggle-slider"></div>
                                        </div>
                                        <span class="toggle-label">g</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- サブタブ2: 製品重量→濃度逆算 -->
                    <div class="sub-tab-content" id="ppm-reverse">
                        <p class="calculator-description">実際の濃度(ppm) = 製品重量(g) × 含有率(%) × 10 ÷ 液量(L)</p>
                        <div class="input-group">
                            <label for="product-weight-input">製品重量:</label>
                            <input type="number" inputmode="decimal" id="product-weight-input" placeholder="例: 6.45">
                            <div class="unit-toggle">
                                <span class="toggle-label">g</span>
                                <div class="toggle-switch" id="weight-toggle-reverse" onclick="toggleWeightUnit('reverse')">
                                    <div class="toggle-slider"></div>
                                </div>
                                <span class="toggle-label">kg</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label for="spray-volume-reverse">散布液量:</label>
                            <input type="number" inputmode="decimal" id="spray-volume-reverse" placeholder="例: 10">
                            <div class="unit-toggle">
                                <span class="toggle-label">L</span>
                                <div class="toggle-switch" id="volume-toggle-reverse" onclick="toggleVolumeUnit('reverse')">
                                    <div class="toggle-slider"></div>
                                </div>
                                <span class="toggle-label">mL</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label for="active-ingredient-reverse">有効成分含有率:</label>
                            <input type="number" inputmode="decimal" id="active-ingredient-reverse" placeholder="例: 3.1">
                            <span>%</span>
                        </div>
                        <div class="button-group">
                            <button id="calculate-ppm-reverse-btn" class="primary-btn">計算する</button>
                            <button type="button" class="clear-btn" onclick="clearForm('ppm-reverse')">クリア</button>
                        </div>
                        <div class="result">
                            <h3>計算結果</h3>
                            <div class="result-item">
                                <span class="result-label">実際の濃度:</span>
                                <span id="concentration-result">-</span>
                                <span>ppm</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">有効成分量:</span>
                                <div class="result-with-unit-toggle">
                                    <span id="active-weight-reverse-result">-</span>
                                    <div class="unit-toggle">
                                        <span class="toggle-label">mg</span>
                                        <div class="toggle-switch" id="active-toggle-reverse" onclick="toggleActiveUnit('reverse')">
                                            <div class="toggle-slider"></div>
                                        </div>
                                        <span class="toggle-label">g</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- タブ6: μmol計算 -->
            <div class="tab-content" id="tab6">
                <div class="calculator">
                    <h2>μmol濃度計算</h2>
                    
                    <!-- サブタブ -->
                    <div class="sub-tabs">
                        <button class="sub-tab-btn active" data-subtab="micromolar-forward">濃度→薬剤量</button>
                        <button class="sub-tab-btn" data-subtab="micromolar-reverse">薬剤量→最大調製量</button>
                    </div>
                    
                    <!-- サブタブ1: 濃度→薬剤量計算 -->
                    <div class="sub-tab-content active" id="micromolar-forward">
                        <p class="calculator-description">μM濃度 × 分子量 ÷ 1000 = ppm濃度　→　必要薬剤量を計算</p>
                        
                        <!-- 薬剤プリセット選択 -->
                        <div class="input-group">
                            <label for="chemical-preset">薬剤プリセット:</label>
                            <select id="chemical-preset" onchange="loadPreset()">
                                <option value="">--- プリセットを選択 ---</option>
                                <optgroup label="除草剤">
                                    <option value="glyphosate">グリホサート (169.07)</option>
                                    <option value="2,4-d">2,4-D (221.04)</option>
                                </optgroup>
                                <optgroup label="殺虫剤">
                                    <option value="imidacloprid">イミダクロプリド (255.66)</option>
                                    <option value="thiacloprid">チアクロプリド (252.72)</option>
                                </optgroup>
                                <optgroup label="オーキシン">
                                    <option value="iaa">インドール酢酸 (IAA) (175.18)</option>
                                    <option value="naa">ナフタレン酢酸 (NAA) (186.21)</option>
                                    <option value="iba">インドール酪酸 (IBA) (203.24)</option>
                                </optgroup>
                                <optgroup label="サイトカイニン">
                                    <option value="bap">6-ベンジルアミノプリン (BAP) (225.25)</option>
                                    <option value="kinetin">カイネチン (215.21)</option>
                                    <option value="zeatin">ゼアチン (219.24)</option>
                                </optgroup>
                                <optgroup label="ジベレリン">
                                    <option value="ga3">ジベレリン (GA3) (346.37)</option>
                                    <option value="ga4">ジベレリン (GA4) (332.39)</option>
                                </optgroup>
                                <optgroup label="その他植物ホルモン">
                                    <option value="aba">アブシジン酸 (ABA) (264.32)</option>
                                    <option value="paclobutrazol">パクロブトラゾール (293.79)</option>
                                </optgroup>
                                <optgroup label="肥料 - 主要元素">
                                    <option value="urea">尿素 (60.06) [N:46%]</option>
                                    <option value="ammonium-sulfate">硫安 (132.14) [N:21%]</option>
                                    <option value="ammonium-nitrate">硝安 (80.04) [N:34%]</option>
                                    <option value="potassium-nitrate">硝酸カリウム (101.10) [N:13% K:44%]</option>
                                    <option value="potassium-sulfate">硫酸カリウム (174.26) [K:50%]</option>
                                    <option value="monopotassium-phosphate">リン酸一カリウム (136.09) [P:52% K:34%]</option>
                                    <option value="calcium-nitrate">硝酸カルシウム (164.09) [N:15.5% Ca:19%]</option>
                                    <option value="magnesium-sulfate">硫酸マグネシウム (246.47) [Mg:9.8%]</option>
                                </optgroup>
                                <optgroup label="肥料 - 微量元素">
                                    <option value="iron-sulfate">硫酸第一鉄 (278.01) [Fe:20%]</option>
                                    <option value="iron-edta">EDTA鉄 (367.07) [Fe:13%]</option>
                                    <option value="zinc-sulfate">硫酸亜鉛 (287.56) [Zn:22.7%]</option>
                                    <option value="manganese-sulfate">硫酸マンガン (169.02) [Mn:32.5%]</option>
                                    <option value="copper-sulfate">硫酸銅 (249.69) [Cu:25.5%]</option>
                                    <option value="boric-acid">ホウ酸 (61.83) [B:17.5%]</option>
                                    <option value="sodium-molybdate">モリブデン酸ナトリウム (241.95) [Mo:39.7%]</option>
                                </optgroup>
                            </select>
                        </div>
                        
                        <!-- 基本情報入力 -->
                        <h3>基本情報</h3>
                        <div class="input-group">
                            <label for="chemical-name">薬剤名:</label>
                            <input type="text" id="chemical-name" placeholder="例: グリホサート">
                        </div>
                        <div class="input-group">
                            <label for="molecular-weight">分子量:</label>
                            <input type="number" inputmode="decimal" id="molecular-weight" placeholder="例: 169.07" step="0.01">
                            <span>g/mol</span>
                        </div>
                        <div class="input-group">
                            <label for="target-micromolar">目標濃度:</label>
                            <input type="number" inputmode="decimal" id="target-micromolar" placeholder="例: 5.0" step="0.1">
                            <select id="concentration-unit">
                                <option value="nM">nM</option>
                                <option value="μM" selected>μM</option>
                                <option value="mM">mM</option>
                                <option value="M">M</option>
                                <option value="mol/L">mol/L</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label for="solution-volume">調製量:</label>
                            <input type="number" inputmode="decimal" id="solution-volume" placeholder="例: 100">
                            <select id="volume-unit">
                                <option value="L">L</option>
                                <option value="mL">mL</option>
                                <option value="μL">μL</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label for="active-concentration">原体濃度:</label>
                            <input type="number" inputmode="decimal" id="active-concentration" placeholder="例: 48.0" step="0.1">
                            <span>%</span>
                            <small id="concentration-hint" class="input-hint"></small>
                        </div>
                        <div class="input-group" id="product-info-group" style="display: none;">
                            <label for="product-formulation">製品剤型:</label>
                            <select id="product-formulation" onchange="updateFormulationInfo()">
                                <option value="">--- 剤型を選択 ---</option>
                            </select>
                            <small id="formulation-hint" class="input-hint"></small>
                        </div>
                        <div class="input-group">
                            <label for="product-density">製品密度:</label>
                            <input type="number" inputmode="decimal" id="product-density" placeholder="例: 1.2" step="0.01">
                            <span>g/mL</span>
                            <small id="density-hint">(液体製品の場合)</small>
                        </div>
                        <div class="input-group" id="recommended-range" style="display: none;">
                            <div class="recommendation-box">
                                <h4>推奨濃度範囲</h4>
                                <span id="recommended-text"></span>
                            </div>
                        </div>
                        
                        <button onclick="calculateMicromolar()">計算する</button>
                        
                        <!-- 計算結果 -->
                        <div class="result">
                            <h3>計算結果</h3>
                            <div class="result-grid">
                                <div class="result-item">
                                    <span class="result-label">変換後濃度:</span>
                                    <span id="converted-ppm">-</span>
                                    <span>ppm</span>
                                </div>
                                <div class="result-item">
                                    <span class="result-label">必要有効成分量:</span>
                                    <span id="required-active">-</span>
                                    <span>mg</span>
                                </div>
                                <div class="result-item">
                                    <span class="result-label">必要製品重量:</span>
                                    <span id="required-product-weight">-</span>
                                    <span>g</span>
                                </div>
                                <div class="result-item">
                                    <span class="result-label">必要製品体積:</span>
                                    <span id="required-product-volume">-</span>
                                    <span>mL</span>
                                </div>
                                <div class="result-item">
                                    <span class="result-label">mol数:</span>
                                    <span id="required-moles">-</span>
                                    <span>μmol</span>
                                </div>
                            </div>
                            
                            <!-- 製品情報表示 -->
                            <div id="product-details" class="product-details" style="display: none;">
                                <h4>選択した製品情報</h4>
                                <div id="product-info-display"></div>
                            </div>
                        </div>
                        
                        <!-- 計算過程 -->
                        <div class="result">
                            <h3>計算過程</h3>
                            <div id="calculation-steps" class="calculation-steps">
                                <p>計算を実行すると、段階的な計算過程が表示されます。</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- サブタブ2: 薬剤量→最大調製量逆算 -->
                    <div class="sub-tab-content" id="micromolar-reverse">
                        
                        <!-- 逆算機能選択 -->
                        <div class="sub-tabs">
                            <button class="nested-tab-btn active" data-nestedtab="reverse-max-volume">最大調製量計算</button>
                            <button class="nested-tab-btn" data-nestedtab="reverse-actual-concentration">実濃度確認</button>
                        </div>
                        
                        <!-- 最大調製量計算 -->
                        <div class="nested-tab-content active" id="reverse-max-volume">
                            <p class="calculator-description">手持ち薬剤量から最大調製可能量を逆算</p>
                            
                            <!-- 薬剤プリセット選択 -->
                            <div class="input-group">
                                <label for="chemical-preset-reverse">薬剤プリセット:</label>
                                <select id="chemical-preset-reverse" onchange="loadPresetReverse()">
                                    <option value="">--- プリセットを選択 ---</option>
                                    <option value="glyphosate">グリホサート (169.07)</option>
                                    <option value="ga3">ジベレリン (GA3) (346.37)</option>
                                    <option value="iaa">インドール酢酸 (IAA) (175.18)</option>
                                    <option value="bap">6-ベンジルアミノプリン (BAP) (225.25)</option>
                                    <option value="aba">アブシジン酸 (ABA) (264.32)</option>
                                    <option value="2,4-d">2,4-D (221.04)</option>
                                    <option value="imidacloprid">イミダクロプリド (255.66)</option>
                                    <option value="thiacloprid">チアクロプリド (252.72)</option>
                                </select>
                            </div>
                            
                            <!-- 基本情報入力 -->
                            <h3>基本情報</h3>
                            <div class="input-group">
                                <label for="chemical-name-reverse">薬剤名:</label>
                                <input type="text" id="chemical-name-reverse" placeholder="例: グリホサート">
                            </div>
                            <div class="input-group">
                                <label for="molecular-weight-reverse">分子量:</label>
                                <input type="number" inputmode="decimal" id="molecular-weight-reverse" placeholder="例: 169.07" step="0.01">
                                <span>g/mol</span>
                            </div>
                            <div class="input-group">
                                <label for="available-amount">手持ち薬剤量:</label>
                                <input type="number" inputmode="decimal" id="available-amount" placeholder="例: 0.5" step="0.001">
                                <span>g</span>
                            </div>
                            <div class="input-group">
                                <label for="active-concentration-reverse">原体濃度:</label>
                                <input type="number" inputmode="decimal" id="active-concentration-reverse" placeholder="例: 48.0" step="0.1">
                                <span>%</span>
                            </div>
                            <div class="input-group">
                                <label for="target-concentration-reverse">目標濃度:</label>
                                <input type="number" inputmode="decimal" id="target-concentration-reverse" placeholder="例: 5.0" step="0.1">
                                <select id="concentration-unit-reverse">
                                    <option value="nM">nM</option>
                                    <option value="μM" selected>μM</option>
                                    <option value="mM">mM</option>
                                    <option value="M">M</option>
                                    <option value="mol/L">mol/L</option>
                                </select>
                            </div>
                            
                            <button onclick="calculateMicromolarReverse()">計算する</button>
                            
                            <!-- 計算結果 -->
                            <div class="result">
                                <h3>計算結果</h3>
                                <div class="result-grid">
                                    <div class="result-item">
                                        <span class="result-label">最大調製可能量:</span>
                                        <span id="max-volume">-</span>
                                        <span>L</span>
                                    </div>
                                    <div class="result-item">
                                        <span class="result-label">有効成分量:</span>
                                        <span id="total-active">-</span>
                                        <span>mg</span>
                                    </div>
                                    <div class="result-item">
                                        <span class="result-label">ppm濃度:</span>
                                        <span id="ppm-concentration">-</span>
                                        <span>ppm</span>
                                    </div>
                                    <div class="result-item">
                                        <span class="result-label">使用率:</span>
                                        <span id="usage-rate">-</span>
                                        <span>%</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 計算過程 -->
                            <div class="result">
                                <h3>計算過程</h3>
                                <div id="calculation-steps-reverse" class="calculation-steps">
                                    <p>計算を実行すると、段階的な計算過程が表示されます。</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 実濃度確認計算 -->
                        <div class="nested-tab-content" id="reverse-actual-concentration">
                            <p class="calculator-description">実際の添加量から実濃度を確認</p>
                            
                            <!-- 薬剤プリセット選択 -->
                            <div class="input-group">
                                <label for="chemical-preset-actual">薬剤プリセット:</label>
                                <select id="chemical-preset-actual" onchange="loadPresetActual()">
                                    <option value="">--- プリセットを選択 ---</option>
                                    <option value="glyphosate">グリホサート (169.07)</option>
                                    <option value="ga3">ジベレリン (GA3) (346.37)</option>
                                    <option value="iaa">インドール酢酸 (IAA) (175.18)</option>
                                    <option value="bap">6-ベンジルアミノプリン (BAP) (225.25)</option>
                                    <option value="aba">アブシジン酸 (ABA) (264.32)</option>
                                    <option value="2,4-d">2,4-D (221.04)</option>
                                    <option value="imidacloprid">イミダクロプリド (255.66)</option>
                                    <option value="thiacloprid">チアクロプリド (252.72)</option>
                                </select>
                            </div>
                            
                            <!-- 基本情報入力 -->
                            <h3>基本情報</h3>
                            <div class="input-group">
                                <label for="chemical-name-actual">薬剤名:</label>
                                <input type="text" id="chemical-name-actual" placeholder="例: グリホサート">
                            </div>
                            <div class="input-group">
                                <label for="molecular-weight-actual">分子量:</label>
                                <input type="number" inputmode="decimal" id="molecular-weight-actual" placeholder="例: 169.07" step="0.01">
                                <span>g/mol</span>
                            </div>
                            <div class="input-group">
                                <label for="actual-amount">実際の添加量:</label>
                                <input type="number" inputmode="decimal" id="actual-amount" placeholder="例: 0.176" step="0.001">
                                <span>g</span>
                            </div>
                            <div class="input-group">
                                <label for="actual-volume">調製量:</label>
                                <input type="number" inputmode="decimal" id="actual-volume" placeholder="例: 100">
                                <select id="actual-volume-unit">
                                    <option value="L">L</option>
                                    <option value="mL">mL</option>
                                    <option value="μL">μL</option>
                                </select>
                            </div>
                            <div class="input-group">
                                <label for="active-concentration-actual">原体濃度:</label>
                                <input type="number" inputmode="decimal" id="active-concentration-actual" placeholder="例: 48.0" step="0.1">
                                <span>%</span>
                            </div>
                            
                            <button onclick="calculateActualConcentration()">計算する</button>
                            
                            <!-- 計算結果 -->
                            <div class="result">
                                <h3>計算結果</h3>
                                <div class="result-grid">
                                    <div class="result-item">
                                        <span class="result-label">実際のppm濃度:</span>
                                        <span id="actual-ppm">-</span>
                                        <span>ppm</span>
                                    </div>
                                    <div class="result-item">
                                        <span class="result-label">実際のμM濃度:</span>
                                        <span id="actual-micromolar">-</span>
                                        <span>μM</span>
                                    </div>
                                    <div class="result-item">
                                        <span class="result-label">有効成分量:</span>
                                        <span id="actual-active-amount">-</span>
                                        <span>mg</span>
                                    </div>
                                    <div class="result-item">
                                        <span class="result-label">製品使用量:</span>
                                        <span id="product-usage">-</span>
                                        <span>g</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 計算過程 -->
                            <div class="result">
                                <h3>計算過程</h3>
                                <div id="calculation-steps-actual" class="calculation-steps">
                                    <p>計算を実行すると、段階的な計算過程が表示されます。</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="instructions">
            <h2>使用方法</h2>
            <p>タブを切り替えて、必要な計算を行ってください。</p>
            <ul>
                <li><strong>希釈倍数から薬量を計算</strong>: 希釈倍数と水の量から必要な農薬量を計算します</li>
                <li><strong>薬量から散布水量を計算</strong>: 希釈倍数と農薬の量から必要な水の量を計算します</li>
                <li><strong>薬量と水量から倍数を計算</strong>: 農薬の量と水の量から希釈倍数を計算します</li>
                <li><strong>くん煙剤計算</strong>: ハウスの寸法（間口×長さ×高さ×棟数）から容積を計算し、登録情報（○○m³あたり○○g）に基づいて必要なくん煙剤の量を計算します</li>
                <li><strong>ppm濃度計算</strong>: ppm濃度と有効成分含有率から必要な製品重量を計算、または逆算で実際の濃度を計算します</li>
                <li><strong>μmol計算</strong>: μM濃度と分子量からppm濃度に変換し、実際の薬剤調製に必要な製品使用量を計算します</li>
            </ul>
            
            <h3>新機能</h3>
            <ul>
                <li><strong>前回入力値の記憶</strong>: 入力した値は自動的に保存され、次回開いた時に復元されます</li>
                <li><strong>ワンタップクリア</strong>: 「クリア」ボタンで入力内容を一括クリアできます</li>
                <li><strong>キーボードショートカット</strong>: Ctrl+Enterで計算、Ctrl+Deleteでクリア</li>
                <li><strong>タッチ最適化</strong>: スマートフォンでの操作を向上させるタッチフレンドリーデザイン</li>
                <li><strong>ダークモード対応</strong>: システムのダークモード設定に自動対応</li>
            </ul>
            
            <p>計算結果の単位は、ドロップダウンやスライドボタンから選択して変換できます。</p>
            <p><strong>希釈計算例</strong>：1000倍希釈で500Lの散布液を作る場合、必要な農薬量は500g（0.5kg）です。</p>
            <p><strong>くん煙剤計算例</strong>：間口6m×長さ30m×高さ3m×棟数1のハウス（540m³）で、400m³あたり50gの登録薬剤の場合、必要量は67.5gです。</p>
            <p><strong>μmol計算例</strong>：グリホサート5μM、100L調製の場合、0.845ppmとなり48%製品を0.176g使用します。</p>
        </div>
        
        <footer>
            <p>農薬希釈計算ツール</p>
        </footer>
    </div>
    
    <!-- ユーティリティ -->
    <script src="js/utils/formatters.js"></script>
    <script src="js/utils/validators.js"></script>
    <script src="js/utils/unit-converter.js"></script>
    <script src="js/utils/storage-helper.js"></script>
    <script src="js/utils/form-helper.js"></script>
    
    <!-- コンポーネント -->
    <script src="js/components/tab-manager.js"></script>
    <script src="js/components/toggle-controls.js"></script>
    
    <!-- 計算機 -->
    <script src="js/calculators/base-calculator.js"></script>
    <script src="js/calculators/pesticide-calculator.js"></script>
    <script src="js/calculators/water-calculator.js"></script>
    <script src="js/calculators/ratio-calculator.js"></script>
    <script src="js/calculators/ppm-calculator.js"></script>
    <!-- シンプルくん煙剤計算 -->
    <script src="js/fumigant-simple.js"></script>
    
    <!-- μmol計算 -->
    <script src="js/micromolar-calculator.js"></script>
    
    <!-- メイン -->
    <script src="js/main.js"></script>
    <script>
        // サービスワーカーの登録（オフライン対応）
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('service-worker.js')
                .then(function(registration) {
                    console.log('Service Worker registered with scope:', registration.scope);
                })
                .catch(function(error) {
                    console.log('Service Worker registration failed:', error);
                });
        }
    </script>
</body>
</html>